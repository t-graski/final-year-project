<div class="admin-dashboard">

  <div class="admin-container">
    <aside class="sidebar">
      <h3>Settings</h3>
      <nav class="sidebar-nav">
        @if (permissionService.$canReadUser() || permissionService.isSuperAdmin()) {
          <button
            class="sidebar-item"
            [class.sidebar-item--active]="$currentView() === 'users'"
            (click)="setView('users')">
            <mat-icon fontIcon="people"></mat-icon>
            <span>Users</span>
          </button>
        }
        @if (permissionService.$canReadCatalog() || permissionService.isSuperAdmin()) {
          <button
            class="sidebar-item"
            [class.sidebar-item--active]="$currentView() === 'courses'"
            (click)="setView('courses')">
            <mat-icon fontIcon="school"></mat-icon>
            <span>Courses</span>
          </button>
        }
        @if (permissionService.$canReadCatalog() || permissionService.isSuperAdmin()) {
          <button
            class="sidebar-item"
            [class.sidebar-item--active]="$currentView() === 'modules'"
            (click)="setView('modules')">
            <mat-icon fontIcon="menu_book"></mat-icon>
            <span>Modules</span>
          </button>
        }

        @if (permissionService.$canReadCatalog()
        || permissionService.$canReadEnrollment()
        || permissionService.$canReadUser()
        || permissionService.isSuperAdmin()) {
          <div class="sidebar-divider"></div>
        }

        @if (permissionService.$canWriteEnrollment() || permissionService.isSuperAdmin()) {
          <button
            class="sidebar-item"
            [class.sidebar-item--active]="$currentView() === 'enroll-course'"
            (click)="setView('enroll-course')">
            <mat-icon fontIcon="person_add"></mat-icon>
            <span>Enroll in Course</span>
          </button>
        }
        @if (permissionService.$canWriteEnrollment() || permissionService.isSuperAdmin()) {
          <button
            class="sidebar-item"
            [class.sidebar-item--active]="$currentView() === 'enroll-module'"
            (click)="setView('enroll-module')">
            <mat-icon fontIcon="playlist_add"></mat-icon>
            <span>Enroll in Module</span>
          </button>
        }

        @if (permissionService.$canReadAudit() || permissionService.isSuperAdmin()) {
          <div class="sidebar-divider"></div>
        }

        @if (permissionService.$canReadAudit() || permissionService.isSuperAdmin()) {
          <button
            class="sidebar-item"
            [class.sidebar-item--active]="$currentView() === 'audit'"
            (click)="setView('audit')">
            <mat-icon fontIcon="history"></mat-icon>
            <span>Audit Log</span>
          </button>
        }
        @if (permissionService.$canReadAudit() || permissionService.isSuperAdmin()) {
          <button
            class="sidebar-item"
            [class.sidebar-item--active]="$currentView() === 'login-audit'"
            (click)="setView('login-audit')">
            <mat-icon fontIcon="login"></mat-icon>
            <span>Login History</span>
          </button>
        }
      </nav>
    </aside>

    <main class="content">
      @if ($isLoading()) {
        <div class="loading">
          <p>Loading...</p>
        </div>
      } @else {
        @if ($currentView() === 'users') {
          <app-admin-users-tab
            ($viewEnrollments)="handleViewUserEnrollments($event)"
          ></app-admin-users-tab>
        }

        @if ($currentView() === 'courses') {
          <app-admin-courses-tab
            ($viewEnrollments)="handleViewCourseEnrollments($event)"
          ></app-admin-courses-tab>
        }

        @if ($currentView() === 'modules') {
          <app-admin-modules-tab
            [courses]="$courses()"
            (viewEnrollments)="handleViewModuleEnrollments($event)"
          ></app-admin-modules-tab>
        }

        @if ($currentView() === 'enroll-course') {
          <app-admin-enroll-course-tab
            [$users]="$users()"
            [$courses]="$courses()"
            [$isLoading]="$isLoading()"
          ></app-admin-enroll-course-tab>
        }

        @if ($currentView() === 'enroll-module') {
          <app-admin-enroll-module-tab
            [$users]="$users()"
            [$courses]="$courses()"
            [$isLoading]="$isLoading()"
          ></app-admin-enroll-module-tab>
        }

        @if ($currentView() === 'audit') {
          <app-admin-audit-tab></app-admin-audit-tab>
        }

        @if ($currentView() === 'login-audit') {
          <app-admin-login-audit-tab></app-admin-login-audit-tab>
        }
      }
    </main>
  </div>

  @if ($showEnrollmentDetails()) {
    <app-enrollment-details
      [mode]="$enrollmentDetailsMode()"
      [entityId]="$enrollmentDetailsEntityId()"
      [entityName]="$enrollmentDetailsEntityName()"
      (close)="closeEnrollmentDetails()"
    ></app-enrollment-details>
  }

</div>
