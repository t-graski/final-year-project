<div class="view-container">
  <div class="view-header">
    <h2>Courses Management</h2>
    <button *appHasPermission="'CatalogWrite'"
            class="action-btn-toolbar action-btn-toolbar--primary"
            (click)="openCreateCourseModal()" title="Add new course">
      <mat-icon fontIcon="add"></mat-icon>
      <span>Add Course</span>
    </button>
  </div>

  <app-dynamic-table
    [$data]="$courses()"
    [$columns]="courseColumns"
    [$actions]="courseActions"
    [$loading]="$isLoading()"
    $searchPlaceholder="Search courses by code or title..."
    $emptyMessage="No courses found"
    ($reload)="reloadCourses()"
  ></app-dynamic-table>
</div>

@if ($showCourseDetails()) {
  <div class="modal-overlay" (click)="closeCourseDetails()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Course Details</h3>
        <button class="modal-close" (click)="closeCourseDetails()">
          <mat-icon fontIcon="close"></mat-icon>
        </button>
      </div>

      <div class="modal-body">
        @for (course of $courses(); track course.id) {
          @if (course.id === $showCourseDetails()) {
            <div class="detail-row">
              <span class="detail-label">Course ID:</span>
              <span class="detail-value">{{ course.id }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Course Code:</span>
              <span class="detail-value">{{ course.courseCode }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Title:</span>
              <span class="detail-value">{{ course.title }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Description:</span>
              <span class="detail-value">{{ course.description || 'N/A' }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Award:</span>
              <span class="detail-value">{{ course.award || 'N/A' }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Duration:</span>
              <span class="detail-value">{{ course.durationSemesters || 'N/A' }} semesters</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Status:</span>
              <span class="detail-value">
                <span class="status" [class.status--active]="course.isActive"
                      [class.status--inactive]="!course.isActive">
                  {{ course.isActive ? 'Active' : 'Inactive' }}
                </span>
              </span>
            </div>
          }
        }
      </div>

      <div class="modal-footer">
        <button class="btn-cancel" (click)="closeCourseDetails()">Close</button>
      </div>
    </div>
  </div>
}

@if ($showCreateCourseModal()) {
  <div class="modal-overlay" (click)="closeCreateCourseModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Create New Course</h3>
        <button class="modal-close" (click)="closeCreateCourseModal()">
          <mat-icon fontIcon="close"></mat-icon>
        </button>
      </div>

      <div class="modal-body">
        <div class="form-group">
          <label for="course-code">Course Code *</label>
          <input
            type="text"
            id="course-code"
            [(ngModel)]="$newCourse().courseCode"
            placeholder="e.g., CS101">
        </div>

        <div class="form-group">
          <label for="course-title">Title *</label>
          <input
            type="text"
            id="course-title"
            [(ngModel)]="$newCourse().title"
            placeholder="Enter course title">
        </div>

        <div class="form-group">
          <label for="course-description">Description</label>
          <textarea
            id="course-description"
            [(ngModel)]="$newCourse().description"
            placeholder="Enter course description"></textarea>
        </div>

        <div class="form-group">
          <label for="course-award">Award</label>
          <input
            type="text"
            id="course-award"
            [(ngModel)]="$newCourse().award"
            placeholder="e.g., BSc Computer Science">
        </div>

        <div class="form-group">
          <label for="course-duration">Duration (Semesters)</label>
          <input
            type="number"
            id="course-duration"
            [(ngModel)]="$newCourse().durationSemesters"
            min="0"
            placeholder="e.g., 6">
        </div>

        <div class="checkbox-group">
          <label>
            <input type="checkbox" [(ngModel)]="$newCourse().isActive">
            <span>Active</span>
          </label>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn-cancel" (click)="closeCreateCourseModal()">Cancel</button>
        <button class="btn-primary" (click)="createCourse()">
          <mat-icon fontIcon="add"></mat-icon>
          Create Course
        </button>
      </div>
    </div>
  </div>
}
